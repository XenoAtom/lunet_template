/**********************************************
 * general (template-shared foundation)
 **********************************************/

$xenoatom-top-offset: 120.5px;
$font-size-base: 1rem;
$font-family-base: Figtree, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans", "Liberation Sans", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";

$bootstrap-icons-font-dir: "../fonts";

@import "bootstrap";
@import "bootstrap-icons";

$xenoatom-ansi: (
    // Rootloops ANSI palette (replace this map to change site theme):
    // https://rootloops.sh?sugar=7&colors=9&sogginess=2&flavor=1&fruit=10&milk=0.96
    background: #1f1b25,
    foreground: #dcd8e4,
    cursor: #a69eb6,

    black: #35303f,
    red: #f75b72,
    green: #67af34,
    yellow: #c98b1a,
    blue: #509af6,
    magenta: #ca64f3,
    cyan: #1faeae,
    white: #a69eb6,

    brightBlack: #5d566c,
    brightRed: #fb8590,
    brightGreen: #75c73b,
    brightYellow: #e49f27,
    brightBlue: #77b1fb,
    brightMagenta: #d68af7,
    brightCyan: #24c6c6,
    brightWhite: #d0ccdb
);

@function xenoatom-ansi($key) {
    @return map-get($xenoatom-ansi, $key);
}

$xenoatom-background: xenoatom-ansi(background);
$xenoatom-foreground: xenoatom-ansi(foreground);
$xenoatom-code-bg: mix(#ffffff, $xenoatom-background, 3%);
$xenoatom-code-inline-bg: mix(#ffffff, $xenoatom-background, 5%);
$xenoatom-code-selection-bg: mix(#ffffff, $xenoatom-background, 20%);

:root {
    --xenoatom-color-background: #{$xenoatom-background};
    --xenoatom-color-background-rgb: #{red($xenoatom-background)}, #{green($xenoatom-background)}, #{blue($xenoatom-background)};
    --xenoatom-color-foreground: #{$xenoatom-foreground};
    --xenoatom-color-foreground-rgb: #{red($xenoatom-foreground)}, #{green($xenoatom-foreground)}, #{blue($xenoatom-foreground)};
    --xenoatom-color-cursor: #{xenoatom-ansi(cursor)};

    --xenoatom-color-black: #{xenoatom-ansi(black)};
    --xenoatom-color-red: #{xenoatom-ansi(red)};
    --xenoatom-color-green: #{xenoatom-ansi(green)};
    --xenoatom-color-yellow: #{xenoatom-ansi(yellow)};
    --xenoatom-color-blue: #{xenoatom-ansi(blue)};
    --xenoatom-color-magenta: #{xenoatom-ansi(magenta)};
    --xenoatom-color-cyan: #{xenoatom-ansi(cyan)};
    --xenoatom-color-white: #{xenoatom-ansi(white)};

    --xenoatom-color-bright-black: #{xenoatom-ansi(brightBlack)};
    --xenoatom-color-bright-red: #{xenoatom-ansi(brightRed)};
    --xenoatom-color-bright-green: #{xenoatom-ansi(brightGreen)};
    --xenoatom-color-bright-yellow: #{xenoatom-ansi(brightYellow)};
    --xenoatom-color-bright-blue: #{xenoatom-ansi(brightBlue)};
    --xenoatom-color-bright-magenta: #{xenoatom-ansi(brightMagenta)};
    --xenoatom-color-bright-cyan: #{xenoatom-ansi(brightCyan)};
    --xenoatom-color-bright-white: #{xenoatom-ansi(brightWhite)};

    // Derived colors used by the website CSS (kept as variables so Prism + others can follow theme).
    --xenoatom-code-bg: #{$xenoatom-code-bg};
    --xenoatom-code-inline-bg: #{$xenoatom-code-inline-bg};
    --xenoatom-code-selection-bg: #{$xenoatom-code-selection-bg};

    // Bootstrap runtime theme variables (do not rely on compile-time Bootstrap theming).
    --bs-body-bg-rgb: var(--xenoatom-color-background-rgb);
    --bs-body-bg: var(--xenoatom-color-background);
    --bs-body-color-rgb: var(--xenoatom-color-foreground-rgb);
    --bs-body-color: var(--xenoatom-color-foreground);
    --bs-body-color-darker-20: hsl(from var(--bs-body-color) h s calc(l - 20));
    --bs-body-color-darker-10: hsl(from var(--bs-body-color) h s calc(l - 10));
    --bs-font-sans-serif: #{inspect($font-family-base)};
}

@font-face {
    font-family: 'Figtree';
    src: url('../fonts/Figtree-VariableFont_wght.ttf') format('truetype');

    font-weight: 100 900;
    font-style: normal;
    font-display: swap;
}

$search-bg: lighten($body-bg, 5%);

.xenoatom-logo {
    display: block;
    width: auto;
    height: 96px;
}

// Show focus only for keyboard users
#xenoatom .navbar-brand:focus {
    outline: none;
}

#xenoatom .navbar-brand:focus-visible {
    outline: 2px dotted var(--bs-link-color);
    outline-offset: 4px;
    border-radius: 4px;
}

body {
    width: calc(100vw - 34px); /* https://stackoverflow.com/a/25981719 */
}

a {
    text-decoration-line: underline;
    text-decoration-style: dotted;
}

h1, h2, h3, h4, h5, h6 {
    outline: none;
    padding-bottom: 0.25em;
    scroll-margin-top: $xenoatom-top-offset;
}

#xenoatom .breadcrumb {
    padding-left: 0.1rem
}

// Bootstrap Icons helpers
.xenoatom-icon,
.xenoatom-feature-icon {
    margin-right: 0.55rem;
    vertical-align: -0.1em;
}

.xenoatom-feature-icon {
    font-size: 1.15em;
}

// Semantic accent colors for icons (keep these lightweight and reusable).
.xenoatom-icon--input { color: var(--xenoatom-color-yellow); }
.xenoatom-icon--actions { color: var(--xenoatom-color-green); }
.xenoatom-icon--lists { color: var(--xenoatom-color-cyan); }
.xenoatom-icon--layout { color: var(--xenoatom-color-magenta); }
.xenoatom-icon--scroll { color: var(--xenoatom-color-blue); }
.xenoatom-icon--chrome { color: var(--xenoatom-color-bright-white); }
.xenoatom-icon--data { color: var(--xenoatom-color-blue); }
.xenoatom-icon--overlays { color: var(--xenoatom-color-magenta); }

.xenoatom-icon--binding { color: var(--xenoatom-color-cyan); }
.xenoatom-icon--controls { color: var(--xenoatom-color-green); }
.xenoatom-icon--editing { color: var(--xenoatom-color-yellow); }
.xenoatom-icon--themes { color: var(--xenoatom-color-magenta); }
.xenoatom-icon--debug { color: var(--xenoatom-color-red); }

.xenoatom-color-0 {
    color: var(--xenoatom-color-red);
}
.xenoatom-color-1 {
    color: var(--xenoatom-color-yellow);
}
.xenoatom-color-2 {
    color: var(--xenoatom-color-green);
}
.xenoatom-color-3 {
    color: var(--xenoatom-color-cyan);
}

blockquote {
    color: #777;
    background-color: rgba(0,0,0, 0.05);
    border-left-color: #35cb8c;
    border-left-style: solid;
    border-left-width: 5px;
    padding-left: 10px;
}

*:focus {
    outline: 0 !important;
}

button.copy-to-clipboard-button > span {
    @extend .bi;
    @extend .bi-copy;
}

button.copy-to-clipboard-button[data-copy-state="copy-success"] > span {
    @extend .bi-check-lg;
    color: #28a745;
}

button.copy-to-clipboard-button[data-copy-state="copy-error"] > span {
    @extend .bi-x-lg;
    color: #dc3545;
}

.c64-text {
    background-image: linear-gradient(to right,
        var(--xenoatom-color-bright-red),
        var(--xenoatom-color-bright-yellow),
        var(--xenoatom-color-bright-green),
        var(--xenoatom-color-bright-cyan),
        var(--xenoatom-color-bright-blue),
        var(--xenoatom-color-bright-magenta));
    background-clip: text;
    color: transparent;
}

.c64-number {
    color: black;
    text-shadow:
        0 0 2px rgba(255,255,255,0.9),
        0 0 6px rgba(255,255,255,0.8),
        0 0 12px rgba(255,255,255,0.7),
        0 0 18px rgba(255,255,255,0.6);
}

.hero-text h1 {
    line-height: 1.08;
}

.hero-text span.c64-number,
.hero-text span.c64-text {
    // Scale down on narrow screens while keeping the desktop presence.
    font-size: clamp(2rem, 9vw, 3.75rem);
    overflow-wrap: anywhere;
    word-break: break-word;
}

@media screen and (max-width: 768px) {
    .hero-text span.c64-number,
    .hero-text span.c64-text {
        // Keep the product name on one line on phones.
        font-size: clamp(1.45rem, 7vw, 3rem);
        white-space: nowrap;
        overflow-wrap: normal;
        word-break: normal;
    }
}

/* Round the video container and clip overflow */
.c64-video-wrap {
    position: relative;
    z-index: 0; // ensure the wrapper forms a stacking context
}

.c64-video-wrap::before {
    content: "";
    position: absolute;
    inset: -2rem -3rem -30rem -3rem;                 // glow outside the video bounds
    background-image: linear-gradient(0deg, transparent 33%,
    rgb(74, 21, 68),
    rgb(59, 33, 86),
    rgb(45, 37, 101),
    rgb(26, 43, 107));
    filter: blur(5rem);
    z-index: -1;                  // behind the video
    pointer-events: none;
}

.c64-video {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;            // fill the frame without distortion
}

.carousel-caption {
    padding-left: 2rem;
}

.svg-diagram {
  width: 100%;
  max-width: 1200px;  /* pick your target max size */
  height: auto;
  padding-bottom: 1em;
}

/**********************************************
 * terminal screenshots (faux window chrome)
 **********************************************/

.terminal-window {
    display: inline-block;
    max-width: 100%;
    margin: 1rem 0;
    border-radius: 14px;
    overflow: hidden;
    background: var(--xenoatom-color-background);
    border: 1px solid rgba(var(--xenoatom-color-foreground-rgb), 0.14);
    box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.45),
        0 6px 18px rgba(0, 0, 0, 0.35);
}

.terminal-window__bar {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: linear-gradient(
        to bottom,
        rgba(var(--xenoatom-color-foreground-rgb), 0.08),
        rgba(var(--xenoatom-color-foreground-rgb), 0.03)
    );
    border-bottom: 1px solid rgba(var(--xenoatom-color-foreground-rgb), 0.10);
}

.terminal-window__controls {
    display: inline-flex;
    gap: 0.5rem;
    align-items: center;
    flex: 0 0 auto;
}

.terminal-window__dot {
    width: 12px;
    height: 12px;
    border-radius: 999px;
    box-shadow:
        inset 0 0 0 1px rgba(0, 0, 0, 0.25),
        0 1px 0 rgba(255, 255, 255, 0.06);
}

.terminal-window__dot--red { background: var(--xenoatom-color-red); }
.terminal-window__dot--yellow { background: var(--xenoatom-color-yellow); }
.terminal-window__dot--green { background: var(--xenoatom-color-green); }

.terminal-window__title {
    flex: 1 1 auto;
    text-align: center;
    font-weight: 600;
    font-size: 0.95rem;
    line-height: 1.2;
    color: rgba(var(--xenoatom-color-foreground-rgb), 0.88);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding-right: 2.5rem; // compensate for left controls to keep title visually centered
}

.terminal-window__content {
    background: var(--xenoatom-color-background);
}

.terminal-window__content > .terminal {
    display: block;
    max-width: 100%;
    height: auto;
}

// When embedding videos, lunet adds width/height attributes which can unintentionally shrink the player.
// Force the video to fill the chrome frame width while preserving aspect ratio.
.terminal-window__content > video.terminal {
    width: 100%;
}

// Frontpage hero media: give it more presence without affecting regular screenshots.
.terminal-window--hero {
    display: block;
    width: min(1200px, 100%);
    margin: 1.25rem auto 1.5rem auto;
}

/**********************************************
 * alerts (NOTE, TIP, WARNING, CAUTION, IMPORTANT)
 **********************************************/

@mixin lunet-alert-icon {
    @extend .bi;
    font-size: 1.3em;
    padding-right: 0.5rem;
    width: 1.4em;
}

@mixin lunet-alert {
    @extend .alert;
    border-radius: .5em;
}

@mixin lunet-alert-heading-text {
    font-weight: bold;
    content: "Information";
}

.lunet-alert-note-icon {
    @include lunet-alert-icon;
    @extend .bi-info-circle;
}

.lunet-alert-note {
    @include lunet-alert;
    @extend .alert-info;
}

.lunet-alert-note-heading-text::before {
    @include lunet-alert-heading-text;
    content: "Note";
}

.lunet-alert-tip-icon {
    @include lunet-alert-icon;
    @extend .bi-lightbulb;
}

.lunet-alert-tip {
    @include lunet-alert;
    @extend .alert-success;
}

.lunet-alert-tip-heading-text::before {
    @include lunet-alert-heading-text;
    content: "Tip";
}

.lunet-alert-warning-icon {
    @include lunet-alert-icon;
    @extend .bi-exclamation-triangle;
}

.lunet-alert-warning {
    @include lunet-alert;
    @extend .alert-warning;
}

.lunet-alert-warning-heading-text::before {
    @include lunet-alert-heading-text;
    content: "Warning";
}

.lunet-alert-important-icon {
    @include lunet-alert-icon;
    @extend .bi-flag;
}

.lunet-alert-caution-icon {
    @include lunet-alert-icon;
    @extend .bi-exclamation-triangle;
}

.lunet-alert-important {
    @include lunet-alert;
    @extend .alert-primary;
}

.lunet-alert-caution {
    @include lunet-alert;
    @extend .alert-danger;
}

.lunet-alert-caution-heading-text::before {
    @include lunet-alert-heading-text;
    content: "Caution";
}

.lunet-alert-important-heading-text::before {
    @include lunet-alert-heading-text;
    content: "Important";
}

.lunet-alert-callout-icon {
    @include lunet-alert-icon;
    @extend .bi-megaphone;
}

.lunet-alert-callout {
    @include lunet-alert;
    @extend .alert-success;
    @extend .alert-dismissible;
}

.lunet-alert-callout-heading-text::before {
    @include lunet-alert-heading-text;
    content: "Announcement";
}

/**********************************************
 * search bar
 **********************************************/
/* Bootstrap 5-powered search dropdown */
.xenoatom-search .dropdown-menu {
    max-height: 50vh;
    overflow-x: hidden;
    overflow-y: auto;
    z-index: 1055; /* above sticky navbar (1020) */
}

/**********************************************
 * frontpage
 **********************************************/
.xenoatom-home h3 > i {
    margin-right: 1rem;
}

.xenoatom-home h3 i.bi {
    text-shadow: 1px 1px 3px #444444;
}

.img-card {
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    margin-bottom: 0.8rem;
    border-radius: 0.6rem!important;
    width: 332px;
}

/**********************************************
 * top navigation bar
 **********************************************/
#xenoatom .navbar .navbar-nav a {
    padding-top: 4px;
}

#xenoatom .navbar .navbar-nav li {
    margin-right: 10px;
}


#xenoatom .navbar a {
    text-decoration: none;
}

#xenoatom .navbar .navbar-nav a i.bi {
    margin-right: 0.4rem;
    opacity: 0.9;
    color: currentColor;
}

#xenoatom li.nav-item.active {
    // use text-shadow instead of font-weight to avoid resize of container and shift of the following menu items
    //text-shadow: 0px 0px 1px $body-color-bold-shadow;
    border-bottom-color: var(--xenoatom-color-blue);
    border-bottom-style: solid;
}

#xenoatom .navbar-right .btn .bi {
    padding: 0.25rem;
}

.bi-heart {
    color: #ea4aaa;
}

#xenoatom .navbar {
    background-color: var(--bs-body-bg);
}

footer {
    text-align: center;
    font-size: 0.9rem;
}

/**********************************************
 * menu in documentation
 **********************************************/
.xenoatom-docs ol.menu {
    list-style: none;
    padding-inline-start: 0px;
}

.xenoatom-docs span.menu-item-row {
    display: inline-block;
    width: 100%;
    padding-bottom: 0.8rem;
}

.xenoatom-docs a.menu-link {
    display: inline-block;
    width: 100%;
    position: relative;
    color: var(--bs-body-color-darker-10);
}

.xenoatom-docs a.menu-link i.bi {
    width: 1.25em;
    display: inline-block;
    text-align: center;
    margin-right: 0.55rem;
    opacity: 0.9;
    color: currentColor;
}

.xenoatom-docs a.menu-link-show {
    display: inline-block;
    position: absolute;
    right: 30px;
}

.xenoatom-docs menu-separator
{
    font-weight: bold;
}

.xenoatom-docs li.menu-item > span > a.menu-link:hover {
    color: var(--bs-body-color);
}

.xenoatom-docs li.menu-item.active > span > a.menu-link {
    display: inline-block;
    width: 100%;
    font-weight: 600;
    color: var(--bs-link-color);
}

.xenoatom-docs a.menu-link-show::before,
.xenoatom-docs a.menu-link-show.collapsed::before {
    @extend .bi;
    @extend .bi-chevron-right;
}

.xenoatom-docs ol.menu ol.menu  {
    margin-left: 0.8rem;
}

.xenoatom-docs li.menu-item {
    list-style-type: none;
    padding-inline-start: 0px;
    border-width: thin;
    border-color: rgba(0, 0, 0, 0.1);
    border-top-style: none;
    border-left-style: none;
    border-right-style: none;
    border-bottom-style: solid;
}

.xenoatom-docs li.menu-item li.menu-item:last-child {
    border-bottom-style: none;
}

.xenoatom-docs li.menu-item a
{
    text-decoration-line: none;
}

.xenoatom-docs footer {
    padding-bottom: 75vh;
}

.menu-level1, .menu-level2, .menu-level3, .menu-level4 {
    font-size: 0.95em;
}

/**********************************************
 * toc in documentation
 **********************************************/
.xenoatom-docs .toc-link::before {
    width: 0px;
}

.menu-sidebar {
    top: $xenoatom-top-offset;

    // Keep docs sidebars navigable when the menu is taller than the viewport.
    // (Works with Bootstrap's `sticky-top` and `collapse` behavior.)
    max-height: calc(100vh - #{$xenoatom-top-offset});
    overflow-y: auto;
    overflow-x: hidden;
    overscroll-behavior: contain;
}

// Only apply low z-index when sidebar is visible as a regular column (not offcanvas)
@include media-breakpoint-up(md) {
    #docs-sidebar-menu.menu-sidebar {
        z-index: 0;
    }
}

#docs-sidebar-toc.menu-sidebar {
    z-index: 0;
}

li.toc-list-item {
    list-style-type: none;
}

.xenoatom-docs a.toc-link {
    text-decoration-line: none;
    //text-decoration-style: dotted;
    color: var(--bs-body-color-darker-20);
    //color: var(--bs-body-color);
}

.xenoatom-docs a.toc-link:hover {
    text-decoration-line: node;
    text-decoration-style: solid;
    color: var(--bs-body-color-darker-10);
}

.xenoatom-docs a.toc-link {
    display: inline-block;
    width: 100%;
}

.xenoatom-docs .js-toc a.toc-link.is-active-link {
    border-left-color: #00CCFF;
    border-left-style: solid;
}

.xenoatom-docs .js-toc a.toc-link {
    display: block;
    padding: .125rem 0 .125rem .75rem;
    text-decoration: none;
    border-left: .125rem solid transparent;
}

.xenoatom-docs .toc-title {
    border-bottom-style: solid;
    border-bottom-width: thin;
    font-size: 1rem;
}

.xenoatom-docs .toc {
    padding-right: 3px;
}

// Scrollbar styling (theme-friendly)
.xenoatom-docs,
.xenoatom-docs * {
    scrollbar-width: thin; // Firefox
    scrollbar-color:
        rgba(var(--xenoatom-color-foreground-rgb), 0.28)
        rgba(var(--xenoatom-color-foreground-rgb), 0.06);
}

.xenoatom-docs ::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

.xenoatom-docs ::-webkit-scrollbar-track {
    background-color: rgba(var(--xenoatom-color-foreground-rgb), 0.05);
}

.xenoatom-docs ::-webkit-scrollbar-thumb {
    background-color: rgba(var(--xenoatom-color-foreground-rgb), 0.18);
    border-radius: 999px;
    border: 2px solid rgba(var(--xenoatom-color-foreground-rgb), 0.05);
}

.xenoatom-docs ::-webkit-scrollbar-thumb:hover {
    background-color: rgba(var(--xenoatom-color-foreground-rgb), 0.26);
}

.xenoatom-docs ol.breadcrumb :first-child a::before {
    // This is a hack, ideally that should be part of the menu.yml
    // but Home is special as it does not have a menu referencing it, so it cannot set itself an icon
    // Solution will be to tag a particular item in menu.yml as the "home" or "self" of the menu
    @extend .bi;
    @extend .bi-house-door;
    padding-right: 0.4em;
}

/* Remove sticky on mobile */
@media screen and (max-width: 768px) {
    .sticky-top {
        position: relative !important;
    }

    .select2-results__option {
        width: auto;
    }

    pre.language-xenoatom {
        font-size: 0.75rem;
    }

    .menu-sidebar {
        top: auto!important;
        max-height: 100dvh;
        overflow-y: hidden;
    }

    // On mobile, let the offcanvas body be the only scroll container.
    #docs-sidebar-menu {
        top: 0 !important;
        bottom: 0;
    }

    #docs-sidebar-menu .offcanvas-header {
        position: sticky;
        top: 0;
        z-index: 1;
        background-color: inherit;
    }

    #docs-sidebar-menu .offcanvas-body {
        max-height: calc(100dvh - 3.5rem);
        overflow-y: auto !important;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        padding-bottom: max(1rem, env(safe-area-inset-bottom));
    }
}

/* Fix responsive offcanvas sidebar layout on large screens */
@include media-breakpoint-up(md) {
    #docs-sidebar-menu .offcanvas-body {
        display: block;
        padding: 0;
        overflow-y: visible;
    }
    #docs-sidebar-menu .offcanvas-header {
        display: none;
    }
}
